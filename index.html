<div x-data="novaApp()" x-init="fetchContent()" class="min-h-screen bg-[#0f0f0f] text-white p-6 font-sans max-w-5xl mx-auto">

  <!-- Search input -->
  <div class="mb-6">
    <input
      type="text"
      placeholder="Search movies or shows..."
      x-model.debounce.500ms="searchQuery"
      @input="searchQuery ? searchContent() : fetchContent()"
      class="w-full rounded-md bg-[#1a1a1a] border border-gray-700 px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
    />
  </div>

  <!-- Tabs -->
  <div class="flex gap-4 mb-6">
    <button
      :class="currentTab === 'movies' ? 'bg-purple-600' : 'bg-gray-800'"
      @click="switchTab('movies')"
      class="px-4 py-2 rounded"
    >Movies</button>
    <button
      :class="currentTab === 'shows' ? 'bg-purple-600' : 'bg-gray-800'"
      @click="switchTab('shows')"
      class="px-4 py-2 rounded"
    >Shows</button>
  </div>

  <!-- Content grid -->
  <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
    <template x-for="item in content" :key="item.id">
      <div class="bg-[#1a1a1a] rounded overflow-hidden cursor-pointer hover:ring-2 hover:ring-purple-500" @click="openContent(item)">
        <img
          :src="`https://image.tmdb.org/t/p/w300${item.poster_path}`"
          :alt="item.title || item.name"
          class="w-full h-44 object-cover"
        />
        <div class="p-2">
          <h3 class="text-sm font-semibold" x-text="item.title || item.name"></h3>
          <p class="text-xs text-gray-400 mt-1">‚≠ê <span x-text="item.vote_average.toFixed(1)"></span>/10</p>
        </div>
      </div>
    </template>
  </div>

  <!-- Pagination -->
  <div class="flex justify-center gap-4 mt-6">
    <button
      :disabled="currentPage === 1"
      @click="changePage(currentPage - 1)"
      class="px-4 py-2 rounded bg-purple-600 disabled:opacity-50 disabled:cursor-not-allowed"
    >
      Prev
    </button>
    <span class="self-center text-gray-400">Page <span x-text="currentPage"></span></span>
    <button
      @click="changePage(currentPage + 1)"
      class="px-4 py-2 rounded bg-purple-600"
    >
      Next
    </button>
  </div>

  <!-- Modal -->
  <div
    x-show="showModal"
    @click.away="showModal = false"
    class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center p-4"
    style="display: none;"
  >
    <div class="bg-[#121212] rounded-lg max-w-xl w-full p-6 overflow-auto max-h-[80vh]">
      <h2 class="text-xl font-bold mb-2" x-text="selectedContent.title || selectedContent.name"></h2>
      <p class="mb-4 text-gray-300" x-text="selectedContent.overview"></p>
      <button @click="showModal = false" class="bg-purple-600 px-4 py-2 rounded">Close</button>
    </div>
  </div>

  <script>
    function novaApp() {
      return {
        apiKey: '1070730380f5fee0d87cf0382670b255',
        currentTab: 'movies',
        searchQuery: '',
        currentPage: 1,
        content: [],
        showModal: false,
        selectedContent: null,

        async fetchContent() {
          const url = `https://api.themoviedb.org/3/${this.currentTab === 'movies' ? 'movie/popular' : 'tv/popular'}?api_key=${this.apiKey}&language=en-US&page=${this.currentPage}`;
          try {
            const res = await fetch(url);
            const data = await res.json();
            this.content = data.results || [];
          } catch (e) {
            console.error('Error fetching content', e);
            this.content = [];
          }
        },

        async searchContent() {
          if (!this.searchQuery.trim()) {
            this.currentPage = 1;
            return this.fetchContent();
          }
          const url = `https://api.themoviedb.org/3/search/${this.currentTab === 'movies' ? 'movie' : 'tv'}?api_key=${this.apiKey}&query=${encodeURIComponent(this.searchQuery)}&language=en-US&page=${this.currentPage}`;
          try {
            const res = await fetch(url);
            const data = await res.json();
            this.content = data.results || [];
          } catch (e) {
            console.error('Error searching content', e);
            this.content = [];
          }
        },

        changePage(page) {
          if (page < 1) return;
          this.currentPage = page;
          if (this.searchQuery.trim()) {
            this.searchContent();
          } else {
            this.fetchContent();
          }
        },

        switchTab(tab) {
          if (this.currentTab === tab) return;
          this.currentTab = tab;
          this.currentPage = 1;
          this.searchQuery = '';
          this.fetchContent();
        },

        openContent(item) {
          this.selectedContent = item;
          this.showModal = true;
        }
      };
    }
  </script>
</div>
